# Nicolas Galeano
# 42505284
# ngaleano@umich.edu


import csv

def analyze_csv(filename):
    with open(filename) as f:
        reader = csv.reader(f)

        header = next(reader)
        
        sample_row = next(reader)

        row_count = 1 + sum(1 for _ in reader)

    print("Column names:")
    print(header)
    print("Sample Row:")
    print(sample_row)
    print("Number of rows:", row_count)

analyze_csv("SampleSuperstore.csv")

# avg price of first class shipments heading into NYC
# which region has the highest avg price of furniture shipments

def load_orders(csv_path):
    with open(csv_path) as f:
        return list(csv.DictReader(f))

rows = load_orders("SampleSuperstore.csv")

def rows_firstclass_nyc(rows):
    d = {}
    for row in rows:
        if row['City'] == 'New York City' and row['Ship Mode'] == 'First Class':
            d[row['Order ID']] = float(row['Sales'])
    return d

def avg_price_firstclass_nyc(d):
    total = 0
    count = 0
    for order in d:
        total += d[order]
        count += 1
    avg_fc_nyc = total / count
    return avg_fc_nyc

def rows_furniture(rows):
    d = {}
    for row in rows:
        if row['Category'] == 'Furniture':
            region = row['Region']
            if region not in d:
                d[region] = []
            d[region].append(float(row['Sales']))
    return d

def region_maxavg_furniture_price(d):
    tup = ("", 0)
    dict = {}
    max_price = 0
    max_region = ""
    for region in d:
        total = 0
        count = 0
        for price in d[region]:
            total += price
            count += 1
        avg_price = total / count
        dict[region] = avg_price
        if avg_price > max_price:
            max_price = avg_price
            max_region = region
    tup = (max_region, max_price)
    return tup

def generate_report(file_name, avg_price_fc_nyc, region_max_furniture):
    region, avg_furn = region_max_furniture
    outFile = open(file_name, "w")
    csvOut = csv.writer(outFile)
    csvOut.write([f"Average Price of First Class Shipments to NYC: {avg_price_fc_nyc}"])
    csvOut.write([f"Region with Highest Average Price of Furniture Shipments: {region} (${avg_furn:.2f})"])
    outFile.close()

load_orders("SampleSuperstore.csv")
d1 = rows_firstclass_nyc(rows)
avg_price_fc_nyc = avg_price_firstclass_nyc(d1)
d2 = rows_furniture(rows)
region_max_furniture = region_maxavg_furniture_price(d2)
generate_report("report.csv", avg_price_fc_nyc, region_max_furniture)
